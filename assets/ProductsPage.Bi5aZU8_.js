import{j as e,f as p,g as y,X as b,m as j}from"./ui-vendor.CP3ud3pA.js";import{P as f}from"./PageHeader.9n5w7q0k.js";import{r as d}from"./react-core.DeQqB7wk.js";import{g as v,u as N,a as w,L as k}from"./index.BnIf7ff2.js";import{a as C,b as R}from"./react-router.BIurctHh.js";import"./i18n-vendor.D6OzzxMc.js";const P=({filters:r,onFilterChange:a,maxPrice:n,origins:c})=>{const[g,l]=d.useState(!1),m=t=>{a({...r,search:t.target.value})},x=(t,o)=>{const h=[...r.priceRange];h[o]=Number(t.target.value),a({...r,priceRange:h})},u=t=>{const o=t.target.value;a({...r,origin:o==="all"?null:o})},i=t=>{a({...r,sortBy:t.target.value})},s=()=>{a({search:"",priceRange:[0,n],origin:null,sortBy:"name-asc"})};return e.jsxs("div",{className:"mb-8 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx("input",{type:"text",placeholder:"Rechercher des produits...",value:r.search,onChange:m,className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"}),e.jsx(p,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("button",{onClick:()=>l(!g),className:"flex items-center text-sm font-medium text-primary-600 dark:text-primary-400",children:[e.jsx(y,{className:"h-4 w-4 mr-1"}),g?"Masquer les filtres":"Afficher les filtres"]}),(r.search||r.priceRange[0]>0||r.priceRange[1]<n||r.origin!==null||r.sortBy!=="name-asc")&&e.jsxs("button",{onClick:s,className:"flex items-center text-sm font-medium text-red-600 dark:text-red-400",children:[e.jsx(b,{className:"h-4 w-4 mr-1"}),"Effacer les filtres"]})]}),g&&e.jsxs(j.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Fourchette de prix (€)"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("input",{type:"number",min:0,max:r.priceRange[1],value:r.priceRange[0],onChange:t=>x(t,0),className:"w-24 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"}),e.jsx("span",{className:"text-gray-500",children:"à"}),e.jsx("input",{type:"number",min:r.priceRange[0],max:n,value:r.priceRange[1],onChange:t=>x(t,1),className:"w-24 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Origine"}),e.jsxs("select",{value:r.origin||"all",onChange:u,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:[e.jsx("option",{value:"all",children:"Toutes origines"}),c.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Trier par"}),e.jsxs("select",{value:r.sortBy,onChange:i,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:[e.jsx("option",{value:"name-asc",children:"Nom (A-Z)"}),e.jsx("option",{value:"name-desc",children:"Nom (Z-A)"}),e.jsx("option",{value:"price-asc",children:"Prix (croissant)"}),e.jsx("option",{value:"price-desc",children:"Prix (décroissant)"})]})]})]})]})]})},F=()=>{const[r,a]=d.useState([]),[n,c]=d.useState(!0);return d.useEffect(()=>{(async()=>{c(!0);try{const l=await v();a(l)}catch(l){console.error("Error fetching products:",l)}finally{c(!1)}})()},[]),{products:r,loading:n}},B=(r,a)=>{const[n,c]=d.useState({search:"",priceRange:[0,1e3],origin:null,sortBy:"name-asc"}),g=d.useMemo(()=>{const i=new Set;return r.forEach(s=>{s.origin&&i.add(s.origin)}),Array.from(i).sort()},[r]),l=d.useMemo(()=>{const i=r.map(t=>t.price),s=Math.max(...i,0);return Math.ceil(s/10)*10},[r]);d.useEffect(()=>{l>0&&n.priceRange[1]===1e3&&c(i=>({...i,priceRange:[i.priceRange[0],l]}))},[l]);const m=d.useMemo(()=>{let i=[...r];if(a&&(i=i.filter(s=>s.category&&typeof s.category=="object"&&s.category!==null&&"slug"in s.category&&s.category.slug&&typeof s.category.slug=="object"&&s.category.slug!==null&&"current"in s.category.slug&&s.category.slug.current===a)),n.search){const s=n.search.toLowerCase();i=i.filter(t=>{var o;return t.name.toLowerCase().includes(s)||((o=t.description)==null?void 0:o.toLowerCase().includes(s))})}switch(i=i.filter(s=>s.price>=n.priceRange[0]&&s.price<=n.priceRange[1]),n.origin&&(i=i.filter(s=>s.origin===n.origin)),n.sortBy){case"price-asc":i.sort((s,t)=>s.price-t.price);break;case"price-desc":i.sort((s,t)=>t.price-s.price);break;case"name-asc":i.sort((s,t)=>s.name.localeCompare(t.name));break;case"name-desc":i.sort((s,t)=>t.name.localeCompare(s.name));break}return i},[r,a,n]);return{filters:n,filteredProducts:m,origins:g,maxPrice:l,handleFilterChange:i=>{c(i)},resetFilters:()=>{c({search:"",priceRange:[0,l],origin:null,sortBy:"name-asc"})}}},S=({categories:r,currentCategory:a,onCategoryChange:n})=>e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-8",children:[e.jsx("button",{onClick:()=>n(void 0),className:`px-4 py-2 rounded-full text-sm font-medium transition-colors ${a?"bg-gray-100 hover:bg-gray-200 text-gray-800":"bg-red-700 text-white"}`,children:"Tous les produits"}),r.map(c=>e.jsx("button",{onClick:()=>n(c.slug.current),className:`px-4 py-2 rounded-full text-sm font-medium transition-colors ${a===c.slug.current?"bg-red-700 text-white":"bg-gray-100 hover:bg-gray-200 text-gray-800"}`,children:c.title},c._id))]}),L=({products:r})=>e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:r.map(a=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg overflow-hidden shadow-md hover:shadow-lg transition-shadow",children:[a.image&&e.jsx("div",{className:"h-48 overflow-hidden",children:e.jsx("img",{src:N(a.image).width(500).height(300).url(),alt:a.name,className:"w-full h-full object-cover transition-transform hover:scale-105"})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"text-xl font-semibold",children:a.name}),a.isHalal&&e.jsx("span",{className:"bg-green-100 text-green-800 text-xs font-medium px-2 py-0.5 rounded",children:"Halal"})]}),a.description&&e.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-sm mb-3 line-clamp-2",children:a.description}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-lg font-bold text-red-700",children:[a.price," €",e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["/",a.unit]})]}),a.origin&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Origine: ",a.origin]})]})]})]},a._id))}),E=({message:r,onReset:a,resetButtonText:n})=>e.jsxs("div",{className:"text-center py-20",children:[e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300",children:r}),e.jsx("button",{onClick:a,className:"mt-4 px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700",children:n})]});function q(){const{categorySlug:r}=C(),a=R(),{products:n,loading:c}=F(),{categories:g}=w(),{filters:l,filteredProducts:m,origins:x,maxPrice:u,handleFilterChange:i,resetFilters:s}=B(n,r),t=c,o=h=>{a(h?`/products/${h}`:"/products")};return e.jsxs(e.Fragment,{children:[e.jsx(f,{title:"Nos Produits",description:"Découvrez notre sélection de viandes de qualité, fraîches et préparées avec savoir-faire."}),e.jsxs("div",{className:"container-custom py-10",children:[e.jsx(S,{categories:g,currentCategory:r,onCategoryChange:o}),e.jsx(P,{filters:l,onFilterChange:i,maxPrice:u,origins:x}),t?e.jsx(k,{}):m.length>0?e.jsx(L,{products:m}):e.jsx(E,{message:"Aucun produit trouvé avec les critères sélectionnés.",onReset:s,resetButtonText:"Réinitialiser les filtres"})]})]})}export{q as default};
